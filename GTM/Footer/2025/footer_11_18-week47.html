<script>
  var fdFncs = fdFncs || {};
  fdFncs.vars = fdFncs.vars || {};
  fdFncs.vars.fdRecognized =
    fdFncs.vars.fdRecognized ||
    (getCookie("fdRecognized") !== undefined ? true : false);
  fdFncs.vars.ref = document.referrer;
  fdFncs.vars.deviceType =
    /Mobile|iP(hone|od|ad)|Android|BlackBerry|IEMobile/.test(
      navigator.userAgent
    )
      ? "m"
      : "d";
  fdFncs.vars.emDiscAmt = "60%";
  fdFncs.vars.emCodeExp = "December 31st, 20" + checkDate.substr(0, 2);
  fdFncs.vars.emDetails =
    "Get a " +
    fdFncs.vars.emDiscAmt +
    " discount on the price of lenses and add-ons with the purchase of an Eyeglass frame or pair of Prescription Sunglasses. Frame purchase required. Offer may not be used on contact lenses or any  Gunnar, Maui Jim, Rec Specs Liberty Sport, InSpatialRx, Ray-Ban Smart Glasses, or VirtuClear products. Costa, Kaenon, Randolph Engineering, Oakley, and Zeal prescription sunglasses are also excluded. Cannot be used in conjunction with price match guarantee. Offer ends " +
    fdFncs.vars.emCodeExp +
    ".";
  $(document).on("click", function (e) {
    if (
      $(e.target).is("#closeSignUp") ||
      ($(e.target).is(".fancybox-overlay") &&
        $(e.target).has("#ctl00_ContentPlaceHolderBody_divThanks").length >
        0) ||
      ($(e.target).is(".fancybox-close") &&
        $("#ctl00_ContentPlaceHolderBody_divThanks").length > 0)
    ) {
      location.reload();
    } else if (
      $(e.target).is("#welcome-close") ||
      $(e.target).is("#welcome-no-thanks") ||
      $(e.target).is("#email-newsletter-nothanks") ||
      $(e.target).is(".fancybox-overlay")
    ) {
      if ($("#email-thanks").is(":visible")) {
        $("#email-thanks").hide();
      }
    }
  });


  function showPromotionalMessage(EmailVal) {
    var promoHTML = '';


    if (
      (checkDate >= "251118" && checkDate <= "251120") ||
      (fdFncs.vars.isTest >= "251118" && fdFncs.vars.isTest <= "251120")
    ) {
      promoHTML = '<div class="px-2"><div id="welcome-msg" class="text-center my-4"><img src="https://images.framesdirect.com/image/upload/v1761318298/homePage/EARLY_BLACK_FRIDAY_BLACK.png" alt="Frames Direct Premium Eyewear" width="350" height="150"><div class="weight-normal pt-5 pb-3 ct_font__20 color-black" style="line-height: 1.2"><span class="weight-bold">Thank you for signing up!</span> <div class=" my-2 weight-normal" style=""> Enjoy up to <span class="weight-bold"> 50% OFF FRAMES</span> from Ray-Ban, Gucci, Oakley, Versace & more <span class="weight-bold"> + 60% OFF LENSES.</span> Until 11/20 </div> <a href="#" id="closeSignUp" class="btn-cta mt-3 p-2" style="background: #AB2317; color: #fff !important; width: 60%; font-size: 20px ">Shop Early deals</a></div></div>';
    } else if (
      (checkDate >= "250124" && checkDate <= "250125") ||
      (fdFncs.vars.isTest >= "250124" && fdFncs.vars.isTest <= "250125")
    ) {
      promoHTML = '<div class="text-center"><img src="https://images.framesdirect.com/image/upload/w_300,f_auto,q_auto/v1664555372/logos/2022-FD-logo-mobile.svg" alt="Frames Direct Premium Eyewear" width="250" height="25"><div class="weight-bold mt-4">Over 100,000 Products and 300 Brands<div class="size-25 mb-3">Enjoy 29% Off Frames<div class="py-1">+</div>65% Off<div class="weight-normal size-8 mt-0">Lenses &amp; Add-ons<div class=" weight-normal">with code:<b>EXTRA5</b></div></div></div><a href="#" id="closeSignUp" class="btn-cta mt-3">Save Now</a></div></div>';
    } else if (
      (checkDate >= "250113" && checkDate <= "250115") ||
      (fdFncs.vars.isTest >= "250113" && fdFncs.vars.isTest <= "250115")
    ) {
      promoHTML = '<div class="text-center"><img src="https://images.framesdirect.com/image/upload/w_300,f_auto,q_auto/v1664555372/logos/2022-FD-logo-mobile.svg" alt="Frames Direct Premium Eyewear" width="250" height="25"><div class="weight-bold mt-4">Over 100,000 Products and 300 Brands<div class="size-25 mb-3">Enjoy 25% Off Frames<div class="py-1">+</div>65% Off<div class="weight-normal size-8 mt-0">Lenses &amp; Add-ons<div class=" weight-normal">with code:<b>EXTRA5</b></div></div></div><a href="#" id="closeSignUp" class="btn-cta mt-3">Save Now</a></div></div>';
    } else {
      promoHTML = '<div class="text-center"><img src="https://images.framesdirect.com/image/upload/w_300,f_auto,q_auto/v1664555372/logos/2022-FD-logo-mobile.svg" alt="Frames Direct Premium Eyewear" width="250" height="25"><div class="weight-bold mt-4">Over 100,000 Products and 300 Brands<div class="size-25 mb-3">Enjoy 20% Off Frames<div class="size-7 weight-normal">with code:<div class="weight-bold size-15">FDFAMILY</div></div><div class="py-1">+</div>60% Off<div class="weight-normal size-8 mt-0">Lenses &amp; Add-ons<div class="size-10">will be applied at checkout automatically</div></div></div><a href="#" id="closeSignUp" class="btn-cta mt-3">Save Now</a></div></div>';
    }
    if ($("#promo-result").length) {
      $("#promo-result").remove();
    }

    $("body").append('<div id="promo-result" class="py-4" style="background: linear-gradient(90deg, #FFE0B4 0%, #C66516 100%);">' + promoHTML + '</div>');


    triggerPromo();


    setTimeout(function () {
      $("body").append('<div id="email-thanks" style="display:none;"></div>');
      $("#email-thanks").load("/customer/thanks.aspx?i=" + EmailVal + " form");
    }, 100);
  }

  function addWelcomeLayer() {
    var message = "",
      offerEnds = "",
      setVid = "",
      setSale = "";
    if (
      (checkDate >= "251025" && checkDate <= "251120") ||
      (fdFncs.vars.isTest >= "251025" && fdFncs.vars.isTest <= "251120")
    ) {
      message =
        '<div class="px-2"><div id="welcome-msg" class="text-center my-4"><img src="https://images.framesdirect.com/image/upload/v1761318298/homePage/EARLY_BLACK_FRIDAY_BLACK.png" alt="Frames Direct Premium Eyewear" width="350" height="150"><div class="weight-normal pt-5 pb-3 ct_font__20 color-black" style="line-height: 1">Sign up now to unlock <div class=" my-2 weight-bold">up to 50% off frames + 60% off lenses</div></div></div>';
    } else if (
      (checkDate >= "250124" && checkDate <= "250125") ||
      (fdFncs.vars.isTest >= "250124" && fdFncs.vars.isTest <= "250125")
    ) {
      message =
        '<div class="px-2"><div id="welcome-msg" class="text-center my-4"><img src="https://images.framesdirect.com/image/upload/w_300,f_auto,q_auto/v1664555372/logos/2022-FD-logo-mobile.svg" alt="Frames Direct Premium Eyewear" width="250" height="25"><div class="weight-medium pt-5 pb-3" style="line-height: 1">Anniversary Sale <div class="size-25 my-3 weight-bold">29% Off Frames<div class="py-3">+</div>65% Off<div class="weight-normal size-8 mt-3">Lenses & Add-ons </div></div></div>';
    } else if (
      (checkDate >= "250113" && checkDate <= "250115") ||
      (fdFncs.vars.isTest >= "250113" && fdFncs.vars.isTest <= "250115")
    ) {
      message =
        '<div class="px-2"><div id="welcome-msg" class="text-center my-4"><img src="https://images.framesdirect.com/image/upload/w_300,f_auto,q_auto/v1664555372/logos/2022-FD-logo-mobile.svg" alt="Frames Direct Premium Eyewear" width="250" height="25"><div class="weight-medium pt-5 pb-3" style="line-height: 1">Early Winter Sale<div class="size-25 my-3 weight-bold">25% Off Frames<div class="py-3">+</div>65% Off<div class="weight-normal size-8 mt-3">Lenses & Add-ons </div></div></div>';
    } else if (
      (checkDate >= "241203" && checkDate <= "241206") ||
      (fdFncs.vars.isTest >= "241203" && fdFncs.vars.isTest <= "241206")
    ) {
      message =
        '<div class="px-2"><img src="https://images.framesdirect.com/image/upload/v1732030602/homePage/FD_HP_CYBERSALE_text.png" alt="Cyber Sale" style="width: 100%; height: auto; max-height: 200px;" fetchpriority="high" usemap="#image-map"><div id="welcome-msg" class="text-center my-4"><div class="py-2" style="line-height: 1.3">Sign up now for access to our Cyber ' +
        setSale +
        " Sale*</div>";
      offerEnds = "*Offer ends 12/06";
    } else {
      message =
        '<div class="px-2"><div id="welcome-msg" class="text-center my-4"><img src="https://images.framesdirect.com/image/upload/w_300,f_auto,q_auto/v1664555372/logos/2022-FD-logo-mobile.svg" alt="Frames Direct Premium Eyewear" width="250" height="25"><div class="weight-medium pt-5 pb-3" style="line-height: 1">First things first, take<div class="size-25 my-3 weight-bold">20% Off Frames<div class="py-3">+</div>60% Off<div class="weight-normal size-8 mt-3">Lenses &amp; Add-ons</div></div></div>';
    }
    var welcomeLayer =
      message +
      '<div class="email-newsletter-form position-relative"><input id="email-newsletter-popup-input" placeholder="Enter your email" name="newsemail" type="email" class="my-2"><a href="#" id="email-newsletter-submit" class="btn-cta " style="background: #AB2317; color: #fff !important; width: 40%;">Sign Up</a><a href="#" id="email-newsletter-nothanks" data-ol-has-click-handler="" class="d-inline-block weight-bold color-black">No thanks</a></div><p class="size-10 mt-4 mb-0">' +
      offerEnds +
      "</p>";
    if ($("#email-welcome").length) {
      $("#email-welcome").remove();
    }
    if ($("#email-thanks").length == 0) {
      $("body").append(
        '<div id="email-thanks" class="text-center p-3 p-md-5 color-white" style="background: linear-gradient(90deg, #FFE0B4 0%, #C66516 100%);">' +
        welcomeLayer +
        "</div>"
      );
    } else {
      $("#email-thanks").html(welcomeLayer);
    }
    addEnterClickHandler(
      "email-newsletter-popup-input",
      "email-newsletter-submit"
    );
    checkDevice();
  }

  function FooterMailPopup(inputid) {
    var Email = document.getElementById(inputid),
      EmailVal = Email.value.toLowerCase().replace(/\s/g, "");
    if (Email !== null && echeck(EmailVal)) {
      // Use the new immediate promotional message function
      showPromotionalMessage(EmailVal);
      setCookie("emlCust", EmailVal);
      setCookie("optInToEmails", "getEmail", 30);
      Email.value = "";
      try {
        setCookie("User_Email_MD5", md5(EmailVal));
        setCookie("User_Email_SHA256", sha256(EmailVal));
        obj = {
          id: "Event",
          Events_UserEmailSub: "1",
          User_Email_MD5: md5(EmailVal),
          User_Email_SHA256: sha256(EmailVal),
        };
      } catch (err) {
        obj = {
          id: "Event",
          Events_Error: "1",
          Error_Source: "Server",
          Error_Code: "utag_data object",
          Error_Detail: "*ERROR_EMAIL_SUB*" + err,
        };
      } finally {
        tealium_data2track.push(obj);
      }
      return true;
    } else {
      Email.focus();
      return false;
    }
  }

  $(document).on("click", "#email-newsletter-submit", function (e) {
    e.preventDefault();
    var $this = $(this);
    $("p.error").remove();
    var Email = document.getElementById("email-newsletter-popup-input"),
      EmailVal = Email.value.toLowerCase().replace(/\s/g, "");

    if (Email !== null && Email.value != "") {
      if (echeck(EmailVal)) {

        showPromotionalMessage(EmailVal);

        try {
          setCookie("User_Email_MD5", md5(EmailVal));
          setCookie("User_Email_SHA256", sha256(EmailVal));
          obj = {
            id: "Event",
            Events_UserEmailSub: "1",
            User_Email_MD5: md5(EmailVal),
            User_Email_SHA256: sha256(EmailVal),
          };
        } catch (err) {
          obj = {
            id: "Event",
            Events_Error: "1",
            Error_Source: "Server",
            Error_Code: "utag_data object",
            Error_Detail: "*ERROR_EMAIL_SUB*" + err,
          };
        } finally {
          tealium_data2track.push(obj);
        }
        setCookie("emlCust", EmailVal);
        setCookie("optInToEmails", "getEmail", 30);
        Email.value = "";
        return false;
      } else {
        $(
          '<p class="color-red mt-2 mb-1 error text-left">Please enter a valid email address.</p>'
        ).insertBefore("#email-newsletter-popup-input");
        Email.focus();
        return false;
      }
    } else {
      //user entered nothing
      return false;
    }
  });


  $(document).on("click", "#sms-newsletter-submit", function (e) {
    e.preventDefault();
    triggerPromo();
    return true;
  });
  $(document).on(
    "click",
    "#welcome-no-thanks, #email-newsletter-nothanks, #welcome-close,.close-overlay",
    function (e) {
      e.preventDefault();
      $("body .fancybox-close").trigger("click");
      $("body .icon-x-thin:before, .icon-x-thin:after").style.backgroundColor('white !important');
    }
  );
  $(document).on("click", "#lm-newsletter-submit", function (e) {
    e.preventDefault();
    FooterMailPopup("lm-newsletter-input");
  });
  $(document).on("click", "#footer-newsletter-submit", function (e) {
    e.preventDefault();
    addWelcomeLayer();
  });
  $(document).on("click", "#sms-newsletter-nothanks", function (e) {
    e.preventDefault();
    triggerPromo();
    return true;
  });
  $(document).on(
    "input",
    "#footer-newsletter-email-input,#email-newsletter-popup-input",
    function () {
      var $this = $(this);
      $this.val($this.val().replace(/\s/g, ""));
    }
  );
  function checkDevice() {
    shadowboxPop(500, 520, "email-thanks", "inner", undefined, true);
  }
  function triggerPromo() {
    shadowboxPop(500, 520, "promo-result", "inner", undefined, true);
  }
  function addEnterClickHandler(inputid, buttonid) {
    var input = document.getElementById(inputid);
    input.addEventListener("keypress", function (e) {
      if (e.key === "Enter") {
        e.preventDefault();
        document.getElementById(buttonid).click();
      }
    });
  }

  function initializeLB() {
    var allowWelcome =
      (fdFncs.vars.noLB === undefined || fdFncs.vars.noLB !== true) &&
      window.location.href.indexOf("/ssl/nps-survey.aspx") === -1 &&
      window.location.href.indexOf("/virtuclear") === -1 &&
      window.location.href.indexOf("/inspatialrx") === -1 &&
      window.location.href.indexOf("/ssl/login/landing_verified.aspx") === -1 &&
      window.location.href.indexOf("/ssl/cart_summary.aspx") === -1 &&
      window.location.href.indexOf("/ssl/login/login.aspx") === -1 &&
      window.location.href.indexOf("/ssl/login/checkout.aspx") === -1 &&
      window.location.href.indexOf("/lens_selection/") === -1 &&
      window.location.href.indexOf("shopping.framesdirect.com") === -1;

    if (allowWelcome && fdFncs.vars.allowEmPop !== false) {
      fdFncs.vars.emailCampaigns =
        getParameterByName("utm_medium").toLowerCase() === "email" ||
        getParameterByName("utm_medium").toLowerCase() === "sms";
      fdFncs.vars.optInToEmails =
        getCookie("optInToEmails") === undefined ||
        getCookie("optInToEmails") !== "getEmail";
      fdFncs.vars.signedIn =
        document.getElementById("ctl00_lbLogin") !== null
          ? document
            .getElementById("ctl00_lbLogin")
            .innerText.toLowerCase()
            .includes("account")
          : false;
      if (fdFncs.vars.emailCampaigns || fdFncs.vars.signedIn) {
        setCookie("optInToEmails", "getEmail", 30);
      } else if (fdFncs.vars.optInToEmails) {
        addWelcomeLayer();
        setCookie("optInToEmails", "getEmail");
      }
    }
  }
  $(function () {
    fdFncs.vars.fdRecognized =
      fdFncs.vars.fdRecognized || getCookie("fdRecognized");
    fdFncs.vars.ref = document.referrer;
    //Update Footer Email Sign-up Title
    if (
      (checkDate >= '251118' && checkDate <= '251120') ||
      (fdFncs.vars.isTest >= '251118' && fdFncs.vars.isTest <= '251120')
    ) {
      // Recognized user logic
      if (fdFncs.vars.fdRecognized !== undefined) {
        $('#footer-newsletter').addClass("d-md-block d-flex justify-content-around")
        $('#footer-newsletter').html(
          '<div class="size-14 weight-normal text-left">Save <span class="weight-bold"> up to 50% off frames <br class="d-md-none">  + 60% off lenses </span> now</div><div id="footer-newsletter-wrapper"><a href="/promotions/black-friday-dp" class="btn-cta  background-white color-black weight-bold d-inline-block py-2 px-3" style="font-size: 12px !important">Shop Deals</a></div>'
        );
      } else {
        // Unrecognized user logic
        $('#footer-newsletter').addClass("d-md-block d-flex justify-content-around")
        $('#footer-newsletter').html(
          '<div class="size-14 weight-normal text-left">Want access to <br class="d-md-none"> Early Black Friday?</div><div id="footer-newsletter-wrapper"><a href="#" id="footer-newsletter-submit" class="btn-cta background-white color-black weight-bold d-inline-block py-2 px-3" style="font-size: 12px !important">Sign up Now</a></div>'
        );
      }
    } else

      if (
        (checkDate >= '250417' && checkDate <= '250420') ||
        (fdFncs.vars.isTest >= '250417' && fdFncs.vars.isTest <= '250420')
      ) {
        // Recognized user logic
        if (fdFncs.vars.fdRecognized !== undefined) {
          $('#footer-newsletter').html(
            '<div class="size-14 weight-normal">Members Week: Up to <span class="weight-bold">30% off top brands + 65% off lenses</span> with code <span class="weight-bold">EXTRA5</span></div><div id="footer-newsletter-wrapper"><a href="/email/customer-appreciation-dp" class="btn-cta btn-small background-white color-black weight-bold d-inline-block py-2 px-3">Save Now</a></div>'
          );
        } else {
          // Unrecognized user logic
          $('#footer-newsletter').html(
            '<div class="size-14 weight-normal">Members Week Deals</div><div id="footer-newsletter-wrapper"><a href="#" id="footer-newsletter-submit" class="btn-cta btn-small background-white color-black weight-bold d-inline-block py-2 px-3">Sign Up</a></div>'
          );
        }
      } else if (
        (checkDate >= "250224" && checkDate <= "250312") ||
        (fdFncs.vars.isTest >= "250224" && fdFncs.vars.isTest <= "250312")
      ) {
        $("#footer-newsletter").html(
          '<div class="size-14 weight-normal">Luxury Style at a Steal: <span class="weight-bold">Up to 50% off frames + 65% off lenses</span></div><div id="footer-newsletter-wrapper"><a href="/sale" class="btn-cta btn-small background-white color-black weight-bold d-inline-block py-2 px-3">Save Now</a></div>'
        );
      } else if (
        (checkDate >= "250218" && checkDate <= "250223") ||
        (fdFncs.vars.isTest >= "250218" && fdFncs.vars.isTest <= "250223")
      ) {
        $("#footer-newsletter").html(
          '<div class="size-14 weight-normal">Save <span class="weight-bold">up to 50% off frames + up to 65% off lenses</span> now</div><div id="footer-newsletter-wrapper"><a href="/sale" class="btn-cta btn-small background-white color-black weight-bold d-inline-block py-2 px-3">Save Now</a></div>'
        );
      } else if (
        (checkDate >= "250214" && checkDate <= "250217") ||
        (fdFncs.vars.isTest >= "250214" && fdFncs.vars.isTest <= "250217")
      ) {
        $("#footer-newsletter").html(
          '<div class="size-14 weight-normal">Limited time deal! Seize an <span class="weight-bold">extra $20 off at cart*</span></div><div id="footer-newsletter-wrapper"><a href="/email/presidents-dp" class="btn-cta btn-small background-white color-black weight-bold d-inline-block py-2 px-3">Save Now</a></div>'
        );
      } else if (
        (fdFncs.vars.fdRecognized !== undefined && fdFncs.vars.fdRecognized !== false) &&
        checkDate >= "250407" ||
        fdFncs.vars.isTest >= "270101"
      ) {
        $("#footer-newsletter").html(
          '<div class="size-14 weight-normal">Thank you for signing up for our newsletter!</div><div id="footer-newsletter-wrapper"><a href="/men/eyewear-dp" class="btn-cta btn-small background-white color-black weight-bold d-inline-block py-2 px-2 mr-3">Shop Men</a><a href="/women/eyewear-dp" class="btn-cta btn-small background-white color-black weight-bold d-inline-block py-2 px-2">Shop Women</a></div>'
        );
      } else {
        $("#footer-newsletter").html(
          '<div class="size-14 weight-normal">Join our mailing list for exclusive offers</div><div id="footer-newsletter-wrapper"><a href="#" id="footer-newsletter-submit" class="btn-cta btn-small background-white color-black weight-bold d-inline-block py-2 px-3">Sign Up</a></div>'
        );
      }
    // Email Sign-up Popup with Cookie
    if (
      !fdFncs.vars.fdRecognized &&
      fdFncs.vars.isUS !== undefined &&
      fdFncs.vars.isUS === "False"
    ) {
      if (
        fdFncs.vars.ref.match(/https:\/\/([^\/]+\.)?framesdirect\.com(\/|$)/i)
      ) {
        setTimeout(initializeLB, 3000);
      } else {
        document.addEventListener("scroll", function (e) {
          var elementTarget = document.getElementById("header-top");
          if (
            window.scrollY >
            elementTarget.offsetTop + elementTarget.offsetHeight
          ) {
            initializeLB();
          }
        });
      }
    }
  });
</script>