<script>
  var fdFncs = fdFncs || {};
  fdFncs.vars = fdFncs.vars || {};
  fdFncs.vars.fdRecognized = fdFncs.vars.fdRecognized || (getCookie("fdRecognized") !== undefined ? true : false);
  fdFncs.vars.ref = document.referrer;
  fdFncs.vars.deviceType = /Mobile|iP(hone|od|ad)|Android|BlackBerry|IEMobile/.test(navigator.userAgent) ? "m" : "d";
  fdFncs.vars.emDiscAmt = "60%";
  fdFncs.vars.emCodeExp = 'December 31st, 20' + checkDate.substr(0,2);
  fdFncs.vars.emDetails = "Get a " + fdFncs.vars.emDiscAmt + " discount on the price of lenses and add-ons with the purchase of an Eyeglass frame or pair of Prescription Sunglasses. Frame purchase required. Offer may not be used on contact lenses or any  Gunnar, Maui Jim, Rec Specs Liberty Sport, InSpatialRx, Ray-Ban Smart Glasses, or VirtuClear products. Costa, Kaenon, Randolph Engineering, Oakley, and Zeal prescription sunglasses are also excluded. Cannot be used in conjunction with price match guarantee. Offer ends " +   fdFncs.vars.emCodeExp + ".";
  $(document).on('click', function(e) {
    if ($(e.target).is('#closeSignUp') || ($(e.target).is('.fancybox-overlay') && $(e.target).has('#ctl00_ContentPlaceHolderBody_divThanks').length > 0) || ($(e.target).is('.fancybox-close') && $('#ctl00_ContentPlaceHolderBody_divThanks').length > 0)) {
      location.reload(); 
    } else if ($(e.target).is('#welcome-close') || $(e.target).is('#welcome-no-thanks') || $(e.target).is('#email-newsletter-nothanks') || $(e.target).is('.fancybox-overlay')) {
      if($('#email-thanks').is(":visible")) {
        $('#email-thanks').hide();
      }
    }
  });
  function textChange() {
    $('#popup-holder-inner:contains("Thank You")').removeAttr('style');
    if ((checkDate >= '250124' && checkDate <= '250125') || (fdFncs.vars.isTest >= '250124' && fdFncs.vars.isTest <= '250125')) {
      $('<div class="text-center"><img src="https://images.framesdirect.com/image/upload/w_300,f_auto,q_auto/v1664555372/logos/2022-FD-logo-mobile.svg" alt="Frames Direct Premium Eyewear" width="250" height="25"><div class="weight-bold mt-4">Over 100,000 Products and 300 Brands<div class="size-25 mb-3">Enjoy 29% Off Frames<div class="py-1">+</div>65% Off<div class="weight-normal size-8 mt-0">Lenses &amp; Add-ons<div class=" weight-normal">with code:<b>EXTRA5</b></div></div></div><a href="#" id="closeSignUp" class="btn-cta mt-3">Save Now</a></div></div>').insertAfter('#ctl00_ContentPlaceHolderBody_divThanks > h1');
      $('#email-code-outter,#email-code-outter + p,#ctl00_ContentPlaceHolderBody_divThanks > h1,#ctl00_ContentPlaceHolderBody_divThanks > p').remove();
    } else if ((checkDate >= '250113' && checkDate <= '250115') || (fdFncs.vars.isTest >= '250113' && fdFncs.vars.isTest <= '250115')) {
      $('<div class="text-center"><img src="https://images.framesdirect.com/image/upload/w_300,f_auto,q_auto/v1664555372/logos/2022-FD-logo-mobile.svg" alt="Frames Direct Premium Eyewear" width="250" height="25"><div class="weight-bold mt-4">Over 100,000 Products and 300 Brands<div class="size-25 mb-3">Enjoy 25% Off Frames<div class="py-1">+</div>65% Off<div class="weight-normal size-8 mt-0">Lenses &amp; Add-ons<div class=" weight-normal">with code:<b>EXTRA5</b></div></div></div><a href="#" id="closeSignUp" class="btn-cta mt-3">Save Now</a></div></div>').insertAfter('#ctl00_ContentPlaceHolderBody_divThanks > h1');
      $('#email-code-outter,#email-code-outter + p,#ctl00_ContentPlaceHolderBody_divThanks > h1,#ctl00_ContentPlaceHolderBody_divThanks > p').remove();
    } else if ((checkDate >= '241203' && checkDate <= '241206') || (fdFncs.vars.isTest >= '241203' && fdFncs.vars.isTest <= '241206')) {
      $('<img src="https://images.framesdirect.com/image/upload/v1732030602/homePage/FD_HP_CYBERSALE_text.png" alt="Cyber Sale" style="width: 100%; height: auto; max-height: 200px;" fetchpriority="high" usemap="#image-map"><div class="size-14 weight-bold text-center">Thank you for signing up!<div class="weight-normal transform-none size-10">Enjoy <b>20% Off FRAMES</b> from<br>Versace, Burberry, &amp; more*<br>+ up to <b>60% OFF LENSES</b> starting at $25.99.<br>Ends 12/06</div><a href="#" id="closeSignUp" class="btn-cta mt-3">Save Now</a><div class="size-7 weight-normal transform-none text-center mt-3">*Some Exclusions Apply</div></div></div>').insertAfter('#ctl00_ContentPlaceHolderBody_divThanks > h1');
      $('#email-code-outter,#email-code-outter + p,#ctl00_ContentPlaceHolderBody_divThanks > h1,#ctl00_ContentPlaceHolderBody_divThanks > p').remove();
    } else if ((checkDate >= '241121' && checkDate <= '241202') || (fdFncs.vars.isTest >= '241121' && fdFncs.vars.isTest <= '241202')) {
      var setVid = 'v1730104850/homePage/FD_HP_EA_Text.mp4',
          setEnd = 'Ends 11/23';
      if ((checkDate >= '241130' && checkDate <= '241202') || (fdFncs.vars.isTest >= '241130' && fdFncs.vars.isTest <= '241202')) {
        setVid = 'v1731058877/homePage/FD_HP_CW_text.mp4';
        setEnd = 'Ends 12/02';
        if (checkDate === '241202' || fdFncs.vars.isTest === '241202') {
          setVid = 'v1731058900/homePage/FD_HP_CM_text.mp4';
        }
      } else if ((checkDate >= '241124' && checkDate <= '241129') || (fdFncs.vars.isTest >= '241124' && fdFncs.vars.isTest <= '241129')) {
        setVid = 'v1730904664/homePage/FD_HP_BFW_text.mp4';
        setEnd = 'Ends 11/29';
        if (checkDate === '241129' || fdFncs.vars.isTest === '241129') {
          setVid = 'v1730904648/homePage/FD_HP_BF_text.mp4';
        }
      }
      $('<video loop autoplay muted playsinline disablePictureInPicture width="100%" class="d-block" style="max-height: 200px"><source src="https://images.framesdirect.com/video/upload/'+setVid+'" /></video><div class="size-14 weight-bold text-center">Thank you for signing up!<div class="weight-normal transform-none size-10">Enjoy up to <b>50% Off FRAMES</b> from<br>Ray-Ban, Gucci, Oakley, Versace, &amp; more*<br>+ <b>60% OFF LENSES</b> starting at $25.99.<br>'+setEnd+'</div><a href="#" id="closeSignUp" class="btn-cta mt-3">Save Now</a><div class="size-7 weight-normal transform-none text-center mt-3">*Some Exclusions Apply</div></div>').insertAfter('#ctl00_ContentPlaceHolderBody_divThanks > h1');
      $('#email-code-outter,#email-code-outter + p,#ctl00_ContentPlaceHolderBody_divThanks > h1,#ctl00_ContentPlaceHolderBody_divThanks > p').remove();
    } else {
      $('<div class="text-center"><img src="https://images.framesdirect.com/image/upload/w_300,f_auto,q_auto/v1664555372/logos/2022-FD-logo-mobile.svg" alt="Frames Direct Premium Eyewear" width="250" height="25"><div class="weight-bold mt-4">Over 100,000 Products and 300 Brands<div class="size-25 mb-3">Enjoy 15% Off Frames<div class="size-7 weight-normal">with code:<div class="weight-bold size-15">FDFAMILY</div></div><div class="py-1">+</div>60% Off<div class="weight-normal size-8 mt-0">Lenses &amp; Add-ons<div class="size-10">will be applied at checkout automatically</div></div></div><a href="#" id="closeSignUp" class="btn-cta mt-3">Save Now</a></div></div>').insertAfter('#ctl00_ContentPlaceHolderBody_divThanks > h1');
      $('#email-code-outter,#email-code-outter + p,#ctl00_ContentPlaceHolderBody_divThanks > h1,#ctl00_ContentPlaceHolderBody_divThanks > p').remove();
    }
    $('#ctl00_ContentPlaceHolderBody_divThanks .msg-disc:last-child').addClass('px-5 size-10').removeClass('size-11').html('<div class="align-left"><strong>Disclaimer:</strong> ' + fdFncs.vars.emDetails + '</div>');
    if (typeof fdFncs.vars.testWelcome != 'undefined') {
      $('#ctl00_ContentPlaceHolderBody_divThanks').addClass('width-60');
      $('#ctl00_ContentPlaceHolderBody_divThanks').parent().addClass('m-auto my-0');
    }
    $('#ctl00_ContentPlaceHolderBody_divThanks h1').removeClass('size-jumbo').addClass('size-40 weight-medium');
    $('#ctl00_ContentPlaceHolderBody_divThanks h1+p').remove();
    $('#email-code-outter').remove();
  }
  function addWelcomeLayer() {
    var message = '',
        offerEnds = '',
        setVid = '',
        setSale = '';
   if ((checkDate >= '250124' && checkDate <= '250125') || (fdFncs.vars.isTest >= '250124' && fdFncs.vars.isTest <= '250125')) {
      message = '<div class="px-2"><div id="welcome-msg" class="text-center my-4"><img src="https://images.framesdirect.com/image/upload/w_300,f_auto,q_auto/v1664555372/logos/2022-FD-logo-mobile.svg" alt="Frames Direct Premium Eyewear" width="250" height="25"><div class="weight-medium pt-5 pb-3" style="line-height: 1">Anniversary Sale <div class="size-25 my-3 weight-bold">29% Off Frames<div class="py-3">+</div>65% Off<div class="weight-normal size-8 mt-3">Lenses & Add-ons </div></div></div>';
    }
    else if ((checkDate >= '250113' && checkDate <= '250115') || (fdFncs.vars.isTest >= '250113' && fdFncs.vars.isTest <= '250115')) {
      message = '<div class="px-2"><div id="welcome-msg" class="text-center my-4"><img src="https://images.framesdirect.com/image/upload/w_300,f_auto,q_auto/v1664555372/logos/2022-FD-logo-mobile.svg" alt="Frames Direct Premium Eyewear" width="250" height="25"><div class="weight-medium pt-5 pb-3" style="line-height: 1">Early Winter Sale<div class="size-25 my-3 weight-bold">25% Off Frames<div class="py-3">+</div>65% Off<div class="weight-normal size-8 mt-3">Lenses & Add-ons </div></div></div>';
    }
    else if ((checkDate >= '241203' && checkDate <= '241206') || (fdFncs.vars.isTest >= '241203' && fdFncs.vars.isTest <= '241206')) {
      message = '<div class="px-2"><img src="https://images.framesdirect.com/image/upload/v1732030602/homePage/FD_HP_CYBERSALE_text.png" alt="Cyber Sale" style="width: 100%; height: auto; max-height: 200px;" fetchpriority="high" usemap="#image-map"><div id="welcome-msg" class="text-center my-4"><div class="py-2" style="line-height: 1.3">Sign up now for access to our Cyber '+setSale+' Sale*</div>';
      offerEnds = '*Offer ends 12/06';
    }
    else if ((checkDate >= '241130' && checkDate <= '241202') || (fdFncs.vars.isTest >= '241130' && fdFncs.vars.isTest <= '241202')) {
      setVid = 'v1731058877/homePage/FD_HP_CW_text.mp4';
      setSale = 'Weekend';
      if (checkDate === '241202' || fdFncs.vars.isTest === '241202') {
        setVid = 'v1731058900/homePage/FD_HP_CM_text.mp4';
        setSale = 'Monday';
      }
      message = '<div class="px-2"><video loop autoplay muted playsinline disablePictureInPicture width="100%" class="d-block" style="max-height: 200px"><source src="https://images.framesdirect.com/video/upload/'+setVid+'" /></video><div id="welcome-msg" class="text-center my-4"><div class="py-2" style="line-height: 1.3">Sign up now for access to our Cyber '+setSale+' Sale*</div>';
      offerEnds = '*Offer ends 12/02';
    }
    else if ((checkDate >= '241124' && checkDate <= '241129') || (fdFncs.vars.isTest >= '241124' && fdFncs.vars.isTest <= '241129')) {
      setVid = 'v1730904664/homePage/FD_HP_BFW_text.mp4';
      setSale = 'Week';
      if (checkDate === '241129' || fdFncs.vars.isTest === '241129') {
        setVid = 'v1730904648/homePage/FD_HP_BF_text.mp4';
        setSale = '';
      }
      message = '<div class="px-2"><video loop autoplay muted playsinline disablePictureInPicture width="100%" class="d-block" style="max-height: 200px"><source src="https://images.framesdirect.com/video/upload/'+setVid+'" /></video><div id="welcome-msg" class="text-center my-4"><div class="py-2" style="line-height: 1.3">Sign up now for access to our Black Friday '+setSale+' Sale*</div>';
      offerEnds = '*Offer ends 11/29';
    }
    else if ((checkDate >= '241121' && checkDate <= '241123') || (fdFncs.vars.isTest >= '241121' && fdFncs.vars.isTest <= '241123')) {
      message = '<div class="px-2"><video loop autoplay muted playsinline disablePictureInPicture width="100%" class="d-block" style="max-height: 200px"><source src="https://images.framesdirect.com/video/upload/v1730104850/homePage/FD_HP_EA_Text.mp4" /></video><div id="welcome-msg" class="text-center my-4"><div class="py-2" style="line-height: 1.3">Sign up now for access to our members only Early Black Friday Sale*</div>';
      offerEnds = '*Offer ends 11/23';
    }
    else {
      message = '<div class="px-2"><div id="welcome-msg" class="text-center my-4"><img src="https://images.framesdirect.com/image/upload/w_300,f_auto,q_auto/v1664555372/logos/2022-FD-logo-mobile.svg" alt="Frames Direct Premium Eyewear" width="250" height="25"><div class="weight-medium pt-5 pb-3" style="line-height: 1">First things first, take<div class="size-25 my-3 weight-bold">15% Off Frames<div class="py-3">+</div>60% Off<div class="weight-normal size-8 mt-3">Lenses &amp; Add-ons</div></div></div>';
    }
    var welcomeLayer = message + '<div class="email-newsletter-form position-relative"><input id="email-newsletter-popup-input" placeholder="Enter your email" name="newsemail" type="email" class="my-2"><a href="#" id="email-newsletter-submit" class="btn-cta">Sign Up</a><a href="#" id="email-newsletter-nothanks" data-ol-has-click-handler="" class="d-inline-block weight-bold">No thanks</a></div><div class="sms-newsletter-form position-relative" style="display:none"><input id="sms-newsletter-popup-input" placeholder="Mobile Number" name="newssms" type="text" class="mt-3"><a href="#" id="sms-newsletter-submit" class="btn-cta mt-3">Sign Up for Text</a><a href="#" id="sms-newsletter-nothanks" class="d-inline-block weight-bold">Decline</span></a><div class="text-left size-8 mt-3">By signing up I provide my signature expressly consenting to contact from FramesDirect at the number and email I provided regarding products or services, including marketing and promotions, via email, live or automated text. I understand that I am not required to enter into this agreement as a condition of any purchase. I can revoke this consent by replying STOP or by unsubscribing from email. I understand that message frequency varies and that message and data rates may apply. I also agree to the information provided at the following links. <a class="decoration-underline" target="_blank" href="/theme/fd-steel/popup/popup-privacy-policy.html">Terms</a> & <a class="decoration-underline" target="_blank" id="privacy-link" aria-label="Open a Popup to Read Privacy Policy" href="/theme/fd-steel/popup/popup-privacy-policy.html">Privacy</a>.</div></div><p class="size-10 mt-4 mb-0">'+offerEnds+'</p>';
    if ($('#email-welcome').length) {
      $('#email-welcome').remove();
    }
    if ($('#email-thanks').length == 0) {
      $('body').append('<div id="email-thanks" class="text-center p-3 p-md-5 color-black">'+welcomeLayer+'</div>');
    } else {
      $('#email-thanks').html(welcomeLayer);
    }
    addEnterClickHandler('email-newsletter-popup-input','email-newsletter-submit');
    addEnterClickHandler('sms-newsletter-popup-input','sms-newsletter-submit');
    phoneNumberValidator('sms-newsletter-popup-input');
    checkDevice();
  }
  function FooterMailPopup(inputid) {
    var Email = document.getElementById(inputid),
        EmailVal = Email.value.toLowerCase().replace(/\s/g, '');
    if (Email !== null && echeck(EmailVal)) {
      setTimeout(function() {
        $('body').append('<div id="email-thanks"></div>');
        $('#email-thanks').load('/customer/thanks.aspx?i=' + EmailVal + ' form', textChange);
        setCookie("emlCust", EmailVal);
        setCookie("optInToEmails", "getEmail", 30);
        Email.value = '';
        try {
          setCookie('User_Email_MD5', md5(EmailVal));
          setCookie('User_Email_SHA256', sha256(EmailVal));
          obj = {
            'id': 'Event',
            'Events_UserEmailSub' : '1',
            'User_Email_MD5' : md5(EmailVal), 
            'User_Email_SHA256' : sha256(EmailVal),
          };

        } catch (err) {
          obj = {
            'id': 'Event',
            'Events_Error': '1',
            'Error_Source': 'Server',
            'Error_Code': 'utag_data object',
            'Error_Detail': '*ERROR_EMAIL_SUB*' + err,
          };
        }
        finally {
          tealium_data2track.push(obj);
        }
        return true;
      },360);
    } else {
      Email.focus();
      return false;
    }
  }
  $(document).on('click','#email-newsletter-submit',function(e) {
    e.preventDefault();
    $('.sms-newsletter-form').show();
    var $this = $(this);
    $('p.error').remove();
    var Email = document.getElementById('email-newsletter-popup-input'),
        EmailVal = Email.value.toLowerCase().replace(/\s/g, '');

    if (Email !== null && Email.value != '') {
      if (echeck(EmailVal)) {
        $('.email-newsletter-form').hide();
        $('.sms-newsletter-form').show();
        if (checkDate > '240403' && checkDate < '240415') {
          $('#welcome-msg > div:first-child > div:first-child').text('Sign up now for access to our member only Private Week Sale. Offer Ends April 14th*')
        }
        else {
          $('#welcome-msg > div:first-child > div:first-child').text('Sign up for texts to get')
        }
        $('<div id="promo-result" class="py-4" style="display:none;"></div').insertAfter('body').load('/customer/thanks.aspx?i=' + EmailVal + ' form', textChange);
        try {
          setCookie('User_Email_MD5', md5(EmailVal));
          setCookie('User_Email_SHA256', sha256(EmailVal));
          obj = {
            'id': 'Event',
            'Events_UserEmailSub' : '1',
            'User_Email_MD5' : md5(EmailVal), 
            'User_Email_SHA256' : sha256(EmailVal),
          };

        } catch (err) {
          obj = {
            'id': 'Event',
            'Events_Error': '1',
            'Error_Source': 'Server',
            'Error_Code': 'utag_data object',
            'Error_Detail': '*ERROR_EMAIL_SUB*' + err,
          };
        }
        finally {
          tealium_data2track.push(obj);
        }
        setCookie("emlCust", EmailVal);
        setCookie("optInToEmails", "getEmail", 30);
        Email.value = '';
        return false;
      }
      else {
        $('<p class="color-red mt-2 mb-1 error text-left">Please enter a valid email address.</p>').insertBefore('#email-newsletter-popup-input'); 
        Email.focus();
        return false;
      }
    }
    else {
      //user entered nothing
      return false;
    }
  }); 
  $(document).on('click','#sms-newsletter-submit',function(e) {
    e.preventDefault();
    $('p.error').remove();
    var $this = $(this),
        Email = document.getElementById('email-newsletter-popup-input'),
        EmailVal = Email.value.toLowerCase().replace(/\s/g, '');
    if ($(window).width() < 993) {
      if (Email !== null && Email.value != '') {
        if (echeck(EmailVal)) {
          $('<div id="promo-result" class="py-4" style="display:none;"></div').insertAfter('body').load('/customer/thanks.aspx?i=' + EmailVal + ' form', textChange);
          try {
            setCookie('User_Email_MD5', md5(EmailVal));
            setCookie('User_Email_SHA256', sha256(EmailVal));
            obj = {
              'id': 'Event',
              'Events_UserEmailSub' : '1',
              'User_Email_MD5' : md5(EmailVal), 
              'User_Email_SHA256' : sha256(EmailVal),
            };

          } catch (err) {
            obj = {
              'id': 'Event',
              'Events_Error': '1',
              'Error_Source': 'Server',
              'Error_Code': 'utag_data object',
              'Error_Detail': '*ERROR_EMAIL_SUB*' + err,
            };
          }
          finally {
            tealium_data2track.push(obj);
          }
          //return false;
        }
        else {
          $('<p class="color-red mt-2 mb-1 error text-left">Please enter a valid 10-digit phone number.</p>').insertBefore('#sms-newsletter-popup-input'); 
          $('#sms-newsletter-popup-input').focus();
          return false;
        }
        setCookie("emlCust", EmailVal);
        setCookie("optInToEmails", "getEmail", 30);
        Email.value = '';
      }
      else {
        //user entered nothing
        return false;
      }
    }
    var number = $('#sms-newsletter-popup-input').val().replace(/\D/g, '').substring(0, 10);
    $('p.error').remove();
    if (number.length > 0) {
      if (number.length === 10) {
        ResponsysSMSSubscribe(number, EmailVal);
        setCookie('User_Email_MD5', md5(EmailVal));
        setCookie('User_Email_SHA256', sha256(EmailVal));
        setCookie('User_Phone_MD5', md5(number));
        setCookie('User_Phone_SHA256', sha256(number))
        try {
          obj = {
            'id': 'Event',
            'Events_UserPhoneSub' : '1',
            'User_Email_MD5' : md5(EmailVal), 
            'User_Email_SHA256' : sha256(EmailVal),
            'User_Phone_MD5' : md5(number),
            'User_Phone_SHA256' : sha256(number)
          };

        } catch (err) {
          obj = {
            'id': 'Event',
            'Events_Error': '1',
            'Error_Source': 'Server',
            'Error_Code': 'utag_data object',
            'Error_Detail': '*ERROR_MOBILE_SUB*' + err,
          };
        }
        finally {
          tealium_data2track.push(obj);
        }
        $this.addClass('disabled');
        $('<div class="text-center"><div class="size-20">Check your texts</div></div>').insertAfter('#promo-result h1');
        triggerPromo();
        setCookie("emlCust", EmailVal);
        setCookie("optInToEmails", "getEmail", 30);
        Email.value = '';
        return true;
      }
      else {
        $('<p class="color-red mt-0 mb-1 error text-left">Please enter a valid 10-digit phone number.</p>').insertBefore('#sms-newsletter-popup-input'); 
        $('#sms-newsletter-popup-input').focus();
        return false;
      }
    }
    else {
      //user entered nothing
      return false;
    }
  }); 
  $(document).on('click','#welcome-no-thanks, #email-newsletter-nothanks, #welcome-close,.close-overlay',function(e) {
    e.preventDefault();
    $('body .fancybox-close').trigger('click');
  });
  $(document).on('click','#lm-newsletter-submit',function(e) {
    e.preventDefault();
    FooterMailPopup('lm-newsletter-input');
  }); 
  $(document).on('click','#footer-newsletter-submit',function(e) {
    e.preventDefault();
    addWelcomeLayer();
  });
  $(document).on('click','#sms-newsletter-nothanks',function(e) {
    e.preventDefault();
    triggerPromo();
    return true;
  });
  $(document).on('input', '#footer-newsletter-email-input,#email-newsletter-popup-input', function () {
    var $this = $(this);
    $this.val($this.val().replace(/\s/g, ''));
  });
  function checkDevice() {
    shadowboxPop(500,520,'email-thanks', 'inner', undefined, true);
  }
  function triggerPromo() {
    shadowboxPop(500,520,'promo-result', 'inner', undefined, true);
  }
  function addEnterClickHandler(inputid, buttonid) {
    var input = document.getElementById(inputid);
    input.addEventListener("keypress", function(e) {
      if (e.key === "Enter") {
        e.preventDefault();
        document.getElementById(buttonid).click();
      }
    });
  }
  function initializeLB() {
    var allowWelcome = (fdFncs.vars.noLB === undefined || fdFncs.vars.noLB !== true) && 
        window.location.href.indexOf('/ssl/nps-survey.aspx') === -1 &&
        window.location.href.indexOf('/virtuclear') === -1 && 
        window.location.href.indexOf('/inspatialrx') === -1 && 
        window.location.href.indexOf('/ssl/login/landing_verified.aspx') === -1 && 
        window.location.href.indexOf('/ssl/cart_summary.aspx') === -1 && 
        window.location.href.indexOf('/ssl/login/login.aspx') === -1 && 
        window.location.href.indexOf('/ssl/login/checkout.aspx') === -1 && 
        window.location.href.indexOf('/lens_selection/') === -1 && 
        window.location.href.indexOf('shopping.framesdirect.com') === -1;

    if (allowWelcome && fdFncs.vars.allowEmPop !== false) {
      fdFncs.vars.emailCampaigns = getParameterByName("utm_medium").toLowerCase() === "email" || getParameterByName("utm_medium").toLowerCase() === "sms";
      fdFncs.vars.optInToEmails = getCookie("optInToEmails") === undefined || getCookie("optInToEmails") !== "getEmail" ;
      fdFncs.vars.signedIn = document.getElementById('ctl00_lbLogin') !== null ? document.getElementById('ctl00_lbLogin').innerText.toLowerCase().includes('account') : false;
      if (fdFncs.vars.emailCampaigns || fdFncs.vars.signedIn) {
        setCookie("optInToEmails", "getEmail", 30);
      } else if (fdFncs.vars.optInToEmails) {
        addWelcomeLayer();
        setCookie("optInToEmails", "getEmail");
      }
    }
  }
  
  $(function () {
    //Update Footer Email Sign-up Title
  if (
      (checkDate >= "250206" && checkDate <= "250217") ||
      (fdFncs.vars.isTest >= "250206" && fdFncs.vars.isTest <= "250217")
    ) {
      $("#footer-newsletter").html(
        '<div class="size-16 weight-medium"><span style="font-weight:400"> Valentine’s Day Savings: </span><span class="weight-bold">20% <br class="d-lg-none">off sunglasses + up to 65% <br class="d-lg-none"> off lenses </span></span></div><br class="d-lg-none"><div id="footer-newsletter-wrapper"><a href="/email/valentine-day-dp" class="btn-cta white mt-3 mt-md-0" style=" color: #fff !important; background: #000; border:2px solid white; ">Save now</a></div>'
        );
    } else {
      $("#footer-newsletter").html(
        '<div class="size-18 weight-medium"><span style="font-weight:400">Save </span><span class="weight-bold">up to 50% off frames + <br class="d-lg-none"> up to 60% off lenses </span><span style="font-weight:400"> now</span></div><br class="d-lg-none"><div id="footer-newsletter-wrapper"><a href="#" id="footer-newsletter-submit" class="btn-cta background-black color-white d-inline-block" style="border:2px solid white; ">Sign Up Now</a></div>'
      );
    }
    // Email Sign-up Popup with Cookie
    if (
      !fdFncs.vars.fdRecognized &&
      fdFncs.vars.isUS !== undefined &&
      fdFncs.vars.isUS === "False"
    ) {
      if (
        fdFncs.vars.ref.match(/https:\/\/([^\/]+\.)?framesdirect\.com(\/|$)/i)
      ) {
        setTimeout(initializeLB, 3000);
      } else {
        document.addEventListener("scroll", function (e) {
          var elementTarget = document.getElementById("header-top");
          if (
            window.scrollY >
            elementTarget.offsetTop + elementTarget.offsetHeight
          ) {
            initializeLB();
          }
        });
      }
    }
  });
</script>