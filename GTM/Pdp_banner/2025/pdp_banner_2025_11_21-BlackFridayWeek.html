<script>
  ////////////////////////////////////
  //for Eyeglasses and Plano Sun PDPs
  ////////////////////////////////////

  //var hasIns = setInterval(checkIns, 360);
  $(window).on('load', function () {
    $('.insurance-app-toggle input').change(function () {
      var $this = $(this)
      if ($this.checked) {
        window.console.log('toggle on');
        $('.lens-bar-holder').hide();
      } else {
        window.console.log('toggle off');
        $('.lens-bar-holder').show();
      }
    });
  });
  function getAmountSavings(product) {

            var retailStr = document.getElementById("spanRetailPrice").innerHTML;
        var saleStr = document.getElementById("spanOurPrice").innerHTML;
    if (!product) return 0;
    var retail =  parseFloat(retailStr.replace("$", ""));
    if (isNaN(retail) || retail <= 0) return 0;

    var discounted =parseFloat(saleStr.replace("$", ""));
    if (isNaN(discounted) || discounted <= 0) return 0;

    var savings = retail - discounted;
    return savings > 0 ? savings : 0;
  }
  function prodDiscoBanner() {
    if (
      (checkDate >= "251121" && checkDate <= "251127") ||
      (fdFncs.vars.isTest >= "251121" && fdFncs.vars.isTest <= "251127")) {

      if ($(".lens-bar-holder").length > 0) {
        $(".lens-bar-holder").remove();
      }

      if (
        ($('h1:contains("Prescription")').length > 0 ||
          $('h1:contains("Eyeglasses")').length > 0 ||
          $('h1:contains("Sunglasses")').length > 0)
      ) {

        // Calculate savings
        var amountSavings = getAmountSavings(fdFncs.currentProduct);

        var savingsText = "";
        if (amountSavings > 0) {
          console.log(amountSavings);
          savingsText =
            '<span style="float:right; font-weight:700; color:black; width: auto;">-$' +
            amountSavings.toFixed(2) +
            "</span>";
        } else {
          savingsText = '<span style="display: none;"></span>';
        }

        $('<div class="lens-bar-holder mx-0 mb-3"><div class="lens-bar d-flex color-black px-2 size-12 text-left " style="justify-content: space-between;  background: linear-gradient(90deg,rgba(190, 226, 247, 1) 0%, rgba(98, 153, 167, 1) 100%); border-radius: 5px;"><div><b> Your Black Friday Week Savings</b></div> <div id="discountPdp" style="display: inline-flex;justify-content: end;align-items: center;"></div>' +
          savingsText +
          "</div></div>"
        ).prependTo("#prod-header-right");
      }
    }
    else
      if (
        (checkDate >= "251109" && checkDate <= "251117") ||
        (fdFncs.vars.isTest >= "251109" && fdFncs.vars.isTest <= "251117")
      ) {
        var excludePgs =
          $('h1:contains("Gunnar")').length === 0 &&
          $('h1:contains("Kaenon")').length === 0 &&
          $('h1:contains("Randolph")').length === 0 &&
          $('h1:contains("Rec Specs")').length === 0 &&
          $('h1:contains("Zeal")').length === 0;

        if ($(".lens-bar-holder").length > 0) {
          $(".lens-bar-holder").remove();
        }
        if (($('h1:contains("Prescription")').length > 0 || $('h1:contains("Eyeglasses")').length > 0 || $('h1:contains("Sunglasses")').length > 0) && excludePgs) {
          $('<div class="lens-bar-holder mx-0 mb-3"><div class="lens-bar d-block color-black px-2 size-12 text-left" style="background:#C9A3A0; border-radius: 5px;">Last Chance:<b> up to 50% off select frames + 60% off lenses with frame purchase</b></div></div>')
            .prependTo("#prod-header-right");
        }
      }

      else
        if (
          (checkDate >= "251103" && checkDate <= "251109") ||
          (fdFncs.vars.isTest >= "251103" && fdFncs.vars.isTest <= "251109")
        ) {
          var excludePgs =
            $('h1:contains("Gunnar")').length === 0 &&
            $('h1:contains("Kaenon")').length === 0 &&
            $('h1:contains("Randolph")').length === 0 &&
            $('h1:contains("Rec Specs")').length === 0 &&
            $('h1:contains("Zeal")').length === 0;

          if ($(".lens-bar-holder").length > 0) {
            $(".lens-bar-holder").remove();
          }
          if (($('h1:contains("Prescription")').length > 0 || $('h1:contains("Eyeglasses")').length > 0 || $('h1:contains("Sunglasses")').length > 0) && excludePgs) {
            $('<div class="lens-bar-holder mx-0 mb-3"><div class="lens-bar d-block color-black px-2 size-12 text-left" style="background:#A7B8BE; border-radius: 5px;">Early Holiday Savings:<b> 25% off select frames + 60% off lenses with frame purchase</b></div></div>')
              .prependTo("#prod-header-right");
          }
        }

        else
          if (
            (checkDate >= "251101" && checkDate <= "251102") ||
            (fdFncs.vars.isTest >= "251101" && fdFncs.vars.isTest <= "251102")
          ) {
            var excludePgs =
              $('h1:contains("Gunnar")').length === 0 &&
              $('h1:contains("Kaenon")').length === 0 &&
              $('h1:contains("Randolph")').length === 0 &&
              $('h1:contains("Rec Specs")').length === 0 &&
              $('h1:contains("Zeal")').length === 0;

            if ($(".lens-bar-holder").length > 0) {
              $(".lens-bar-holder").remove();
            }
            if (($('h1:contains("Prescription")').length > 0 || $('h1:contains("Eyeglasses")').length > 0 || $('h1:contains("Sunglasses")').length > 0) && excludePgs) {
              $('<div class="lens-bar-holder mx-0 mb-3"><div class="lens-bar d-block color-black px-2 size-12 text-left" style="background:#B7C4B3; border-radius: 5px;">Early Holiday Weekend:<b> 25% off select frames + 60% off lenses with frame purchase</b></div></div>')
                .prependTo("#prod-header-right");
            }
          }

          else

            if (
              (checkDate >= "251009" && checkDate <= "251026") ||
              (fdFncs.vars.isTest >= "251009" && fdFncs.vars.isTest <= "251026")
            ) {
              var excludePgs =
                $('h1:contains("Gunnar")').length === 0 &&
                $('h1:contains("Kaenon")').length === 0 &&
                $('h1:contains("Randolph")').length === 0 &&
                $('h1:contains("Rec Specs")').length === 0 &&
                $('h1:contains("Zeal")').length === 0;

              if ($(".lens-bar-holder").length > 0) {
                $(".lens-bar-holder").remove();
              }
              if (($('h1:contains("Prescription")').length > 0 || $('h1:contains("Eyeglasses")').length > 0 || $('h1:contains("Sunglasses")').length > 0) && excludePgs) {
                $('<div class="lens-bar-holder mx-0 mb-3"><div class="lens-bar d-block color-black px-2 size-12 text-left" style="background:#CBC4BA; border-radius: 5px;">Get your complete pair:<b> 40% off select frames</b> at checkout <b>+ 60% off lenses with frame purchase</b></div></div>')
                  .prependTo("#prod-header-right");
              }
            }

            else
              if (
                (checkDate >= "251007" && checkDate <= "251008") ||
                (fdFncs.vars.isTest >= "251007" && fdFncs.vars.isTest <= "251008")
              ) {
                var excludePgs =
                  $('h1:contains("Gunnar")').length === 0 &&
                  $('h1:contains("Kaenon")').length === 0 &&
                  $('h1:contains("Randolph")').length === 0 &&
                  $('h1:contains("Rec Specs")').length === 0 &&
                  $('h1:contains("Zeal")').length === 0;

                if (
                  $('h1:contains("Costa")').length > 0 ||
                  $('h1:contains("Oakley")').length > 0 ||
                  $('h1:contains("Maui Jim")').length > 0 ||
                  $('h1:contains("Prescription")').length > 0 ||
                  $('h1:contains("Sunglasses")').length > 0);
                {
                  $('<div class="lens-bar-holder mx-0 mb-3 mt-4"><div class="lens-bar d-block color-black px-2 size-12 text-left" style="background:#AAB9C0; border-radius: 5px;"><b>40% off sun lenses</b> by Oakley, Costa & Maui Jim with code <b>SPECIAL40</b> </div></div>')
                    .prependTo("#prod-header-right");
                }
              }
              else
                if (
                  (checkDate >= "250929" && checkDate <= "251007") ||
                  (fdFncs.vars.isTest >= "250929" && fdFncs.vars.isTest <= "251007")
                ) {
                  var excludePgs =
                    $('h1:contains("Gunnar")').length === 0 &&
                    $('h1:contains("Kaenon")').length === 0 &&
                    $('h1:contains("Randolph")').length === 0 &&
                    $('h1:contains("Rec Specs")').length === 0 &&
                    $('h1:contains("Zeal")').length === 0;

                  if ($(".lens-bar-holder").length > 0) {
                    $(".lens-bar-holder").remove();
                  }
                  if (($('h1:contains("Prescription")').length > 0 || $('h1:contains("Eyeglasses")').length > 0 || $('h1:contains("Sunglasses")').length > 0) && excludePgs) {
                    $('<div class="lens-bar-holder mx-0 mb-3 mt-4"><div class="lens-bar d-block color-black px-2 size-12 text-left" style="background:#C9A3A0; border-radius: 5px;">Fall deals: up to <b>50% off select frames + 60% off lenses</b> </div></div>')
                      .prependTo("#prod-header-right");
                  }
                }

                else
                  if (
                    (checkDate >= "250915" && checkDate <= "250928") ||
                    (fdFncs.vars.isTest >= "250915" && fdFncs.vars.isTest <= "250928")
                  ) {
                    var excludePgs =
                      $('h1:contains("Gunnar")').length === 0 &&
                      $('h1:contains("Kaenon")').length === 0 &&
                      $('h1:contains("Randolph")').length === 0 &&
                      $('h1:contains("Rec Specs")').length === 0 &&
                      $('h1:contains("Zeal")').length === 0;

                    if ($(".lens-bar-holder").length > 0) {
                      $(".lens-bar-holder").remove();
                    }
                    if ($('h1:contains("Wiley X")').length > 0) {
                      $(
                        '<div class="lens-bar-holder mx-0 mb-3"><div class="lens-bar d-block color-black px-2 size-12 text-left" style="background:#fff; border-radius: 5px;">Get your complete pair:<b> 40% off select frames</b> at checkout <b>+ 60% off lenses</b></div></div>'
                      ).prependTo("#prod-header-right");
                      $('<div class="lens-bar-holder mx-0 mb-3 mt-4"><div class="lens-bar d-block color-black px-2 size-12 text-left" style="background:#CBC4BA; border-radius: 5px;"><b>Get a free hat</b> with every Wiley X prescription glasses purchase. While supplies last. Directly applied at checkout.</div></div>')
                        .prependTo("#prod-header-right");

                    }
                    else if (($('h1:contains("Prescription")').length > 0 || $('h1:contains("Eyeglasses")').length > 0 || $('h1:contains("Sunglasses")').length > 0) && excludePgs) {
                      $(
                        '<div class="lens-bar-holder mx-0 mb-3"><div class="lens-bar d-block color-black px-2 size-12 text-left" style="background:#fff; border-radius: 5px;">Get your complete pair:<b> 40% off select frames</b> at checkout <b>+ 60% off lenses</b></div></div>'
                      ).prependTo("#prod-header-right");
                    }
                  } else
                    if (
                      (checkDate >= "250902" && checkDate <= "250914") ||
                      (fdFncs.vars.isTest >= "250902" && fdFncs.vars.isTest <= "250914")
                    ) {
                      var excludePgs =
                        $('h1:contains("Gunnar")').length === 0 &&
                        $('h1:contains("Kaenon")').length === 0 &&
                        $('h1:contains("Randolph")').length === 0 &&
                        $('h1:contains("Rec Specs")').length === 0 &&
                        $('h1:contains("Ray-Ban Meta")').length === 0 &&
                        $('h1:contains("Zeal")').length === 0;

                      if ($(".lens-bar-holder").length > 0) {
                        $(".lens-bar-holder").remove();
                      }

                      if (
                        $('h1:contains("Costa")').length > 0 ||
                        $('h1:contains("Oakley")').length > 0 ||
                        $('h1:contains("Maui Jim")').length > 0
                      ) {
                        $('<div class="lens-bar-holder mx-0 mb-3 mt-4"><div class="lens-bar d-block color-black px-2 size-12 text-left" style="background:#AAB9C0; border-radius: 5px;"><b>40% off prescription sun lenses</b> by Oakley, Costa & Maui Jim with code <b>SPECIAL40</b></div></div>')
                          .prependTo("#prod-header-right");
                      }
                    } else
                      if (
                        (checkDate >= "250707" && checkDate <= "250711") ||
                        (fdFncs.vars.isTest >= "250707" && fdFncs.vars.isTest <= "250711")
                      ) {
                        var excludePgs =
                          $('h1:contains("Gunnar")').length === 0 &&
                          $('h1:contains("Kaenon")').length === 0 &&
                          $('h1:contains("Randolph")').length === 0 &&
                          $('h1:contains("Rec Specs")').length === 0 &&
                          $('h1:contains("Zeal")').length === 0;

                        if ($(".lens-bar-holder").length > 0) {
                          $(".lens-bar-holder").remove();
                        }
                        if ($('h1:contains("Wiley X")').length > 0) {
                          $('<div class="lens-bar-holder mx-0 mb-3 mt-4"><div class="lens-bar d-block color-black px-2 size-12 text-left" style="background:#EDE9DE; border-radius: 5px;"><b>Get a free hat</b> with every Wiley X prescription glasses purchase. While supplies last. Directly applied at checkout.</div></div>')
                            .prependTo("#prod-header-right");
                        }
                      }
  }
  $(function () {
    prodDiscoBanner();
  });


  //////////////////
  //for Rx Sun PDPs
  //////////////////

  function updateRxSunPolarizedDiscount() {
    if (
      (checkDate >= "241101" && checkDate <= "241103") ||
      (fdFncs.vars.isTest >= "241101" && fdFncs.vars.isTest <= "241103")
    ) {
      var brands = [
        "armani-exchange",
        "arnette",
        "brooks-brothers",
        "burberry",
        "coach",
        "costa",
        "dolce-gabbana",
        "emporio-armani",
        "giorgio-armani",
        "oakley",
        "polo",
        "ralph-lauren",
        "ray-ban",
        "tory-burch",
        "versace",
        "vogue",
      ];
      for (brand in brands) {
        if (
          pgURLPath(brands[brand]) &&
          $(
            "#ctl00_ContentPlaceHolderProductDisplay_ddlLensColor option:selected"
          )
            .text()
            .includes("Polarized")
        ) {
          addLensDiscountToRxSun(20, true, "discount in cart", false, true);
          break;
        } else if (pgURLPath("costa") || pgURLPath("oakley")) {
          $("#lens-price span").remove();
          $(".total-retail.lens, .total-retail.total").text("");
        }
      }
    }
  }
  $(function () {
    updateRxSunPolarizedDiscount();
  });

  function addLensDiscountToRxSun(amt, percentage, promoCode, noCode, polar) {
    //This function assumes the lens discount off
    var newSalePrice = 0;
    if (percentage && !noCode) {
      if (polar) {
        var bnr = "";
        if (!pgURLPath("oakley") && !pgURLPath("costa")) {
          bnr += "60% Off";
        }
        if ($(".lens-bar").length < 1) {
          $(
            '<div class="lens-bar background-green color-white d-flex justify-content-center mb-2"><div class="size-10">Polarized: ' +
            amt +
            "% Off Frame + " +
            bnr +
            " Lenses in Cart</div></div>"
          ).prependTo(".fd-rx-sun #prod-header-right");
        } else {
          $(".lens-bar").html(
            '<div class="size-10">Polarized: ' +
            amt +
            "% Off Frame + " +
            bnr +
            " Lenses in Cart</div>"
          );
        }
        if (pgURLPath("costa") || pgURLPath("oakley")) {
          if ($(".lens-discount-code").length < 1) {
            $(
              '<div class="align-right neg-marg"><div class="size-8 color-green weight-bold"><span class="lens-discount-code">' +
              promoCode +
              "</span></div></div>"
            ).appendTo("#prod-price-items");
          } else {
            $(".lens-discount-code").text(promoCode);
          }
        }
      } else {
        if ($(".lens-bar").length < 1) {
          $(
            '<div class="lens-bar background-green color-white d-flex justify-content-center mb-2"><div class="size-10">' +
            amt +
            '% Off Rx Lenses: <span class="ps-lens-promo transform-uppercase weight-bold">' +
            promoCode +
            "</span></div></div>"
          ).prependTo(".fd-rx-sun #prod-header-right");
        } else {
          $(".lens-bar").html(
            '<div class="size-10">' +
            amt +
            '% Off Rx Lenses: <span class="ps-lens-promo transform-uppercase weight-bold">' +
            promoCode +
            "</span></div>"
          );
        }
      }
      if (pgURLPath("costa") || pgURLPath("oakley")) {
        newSalePrice =
          (parseFloat(
            $(".total-sale.lens")
              .html()
              .match(/[\d\.]+/)
          ) *
            (100 - amt)) /
          100;
        $("#lens-price .size-11 span").remove();
        $("#lens-price .size-11").append(
          $('<span class="amt-disc">' + amt + "% Off</span>")
        );
      }
      clearInterval(checkIns);
      hasIns = null;
    } else if (percentage && noCode) {
      if ($(".lens-bar").length < 1) {
        $(
          '<div class="lens-bar background-green color-white d-flex justify-content-center mb-2"><div class="size-10">' +
          amt +
          '% Off Rx Lenses<span class="ps-lens-promo transform-uppercase weight-bold"></span></div>'
        ).prependTo(".fd-rx-sun #prod-header-right");
      }
      if (pgURLPath("costa") || pgURLPath("oakley")) {
        newSalePrice =
          (parseFloat(
            $(".total-sale.lens")
              .html()
              .match(/[\d\.]+/)
          ) *
            (100 - amt)) /
          100;
        $("#lens-price .size-11 span").remove();
        $("#lens-price .size-11").append(
          $('<span class="amt-disc">' + amt + "% Off</span>")
        );
      }
      clearInterval(checkIns);
      hasIns = null;
    } else {
      if ($(".lens-bar").length < 1) {
        $(
          '<div class="lens-bar background-green color-white d-flex justify-content-center"><div class="size-10">$' +
          amt +
          ' Off Polarized Rx Lenses <span class="ps-lens-promo transform-uppercase weight-bold"></span></div>'
        ).prependTo(".fd-rx-sun #prod-header-right");
      }
      if (pgURLPath("costa") || pgURLPath("oakley")) {
        newSalePrice =
          parseFloat(
            $(".total-sale.lens")
              .html()
              .match(/[\d\.]+/)
          ) - 30;
        $("#lens-price .size-11 span").remove();
        $("#lens-price .size-11").append(
          $('<span class="amt-disc">' + amt + "% Off</span>")
        );
      }
      clearInterval(checkIns);
      hasIns = null;
    }
    if (pgURLPath("costa") || pgURLPath("oakley")) {
      var lensRetailPrice = parseFloat(
        $(".total-sale.lens")
          .html()
          .match(/[\d\.]+/)
      ).toFixed(2),
        frameRetailPrice,
        frameSalePrice;
      //this becomes the old total sale above -
      $(".total-retail.lens").html("$" + lensRetailPrice);
      //discount this to the amount above (percentage or amt);
      $(".total-sale.lens").html("$" + newSalePrice.toFixed(2));
      //update Total at bottom - add frame price + lens price
      //combine Frame + Lens retail price
      if ($("#spanRetailPrice").text().trim() !== "") {
        frameRetailPrice = parseFloat(
          $("#spanRetailPrice")
            .text()
            .match(/[\d\.]+/)
        );
      } else {
        frameRetailPrice = parseFloat(
          $("#spanOurPrice")
            .text()
            .match(/[\d\.]+/)
        );
      }
      frameSalePrice = parseFloat(
        $("#spanOurPrice")
          .text()
          .match(/[\d\.]+/)
      );
      //combine frame + lens sale price.
      var totalRetail = (
        parseFloat(lensRetailPrice) + parseFloat(frameRetailPrice)
      ).toFixed(2),
        totalSale = (frameSalePrice + newSalePrice).toFixed(2);
      $("#prod-price-items .total-sale.total").html("$" + totalSale);
      $("#prod-price-items .total-retail.total").html("$" + totalRetail);
      clearInterval(checkIns);
      hasIns = null;
    }
  }
</script>